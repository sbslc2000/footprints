---
상위 링크: "[[Organization of Records in Files]]"
---
# Heap File Organizations
힙 파일 구성에서 레코드는 릴레이션에 해당하는 파일의 어디에나 저장될 수 있다. 특정 위치를 고집할 필요도 없고, 한번 배치된다면 일반적으로 잘 이동하지 않는다.

레코드를 삽입할 때 일반적으로 항상 파일의 끝 부분에 추가하겠지만, 레코드가 삭제되어 빈 공간이 존재한다면 이를 채우는 것이 좋을 것이다. **따라서 데이터베이스 시스템은 파일의 모든 블록을 순차적으로 검색하지 않고도 빈 곳이 있는 블록을 효율적으로 찾을 수 있어야 한다.**

## Free-Space Map
Free-Space Map은 릴레이션의 각 블록에 대해 얼마나 여유공간이 있는지를 표현한 맵으로, 파일 내에 유지된다.

![](https://i.imgur.com/xZm1ah2.png)
위 배열은 각 블록의 여유공간을 갖고 있는 배열이다. 배열의 요소는 3 bit를 사용한다고 가정하였다. 첫번째 배열 값인 4는 첫번째 블록에 4/8 만큼 여유공간이 있다는 것을 표현한다. 이 값이 0인 공간은 여유 공간이 없는 것으로 취급한다. 이를 통해 데이터를 삽입할 때 불필요한 블록 접근을 발생시키지 않을 수 있다.

![](https://i.imgur.com/IpzYKEP.png)

릴레이션이 매우 크다면 배열도 매우 커질 것이다. 여유 공간이 충분한 블록을 찾는 작업의 속도를 높이기 위해 2계층의 여유 공간 맵을 만들 수도 있다. 위 2계층 여유 공간 맵에서 첫번째 4라는 값은 '첫 4개의 블록에는 적어도 4/8 만큼 여유있는 블록이 있다'라는 것을 의미한다. 

레코드가 생성/수정/삭제 될 때마다 여유 공간 맵을 디스크에 쓰는 것은 비용이 많이 들 수 있다. 따라서 여유 공간 맵은 주기적으로 쓰는 것이 일반적이다.

## 장점
* 빠른 삽입 : 삽입될 위치를 상수시간에 찾을 수 있으며, 별도로 재정렬을 필요로 하지 않는다.
* 단순한 구현 : 단순하다!