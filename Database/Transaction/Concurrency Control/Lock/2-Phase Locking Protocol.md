---
상위 개념: "[[Lock]]"
---
# 2-Phase Locking Protocol

![](https://i.imgur.com/eDHG6pN.png)

> 트랜잭션은 잠금을 얻는 동안에는 얻기만 해야하고, 해제하는 동안에는 해제하기만 해야한다.

2단계 잠금 규약 (2 Phase Locking Protocol)은 충돌 직렬가능 스케줄을 보장하는 잠금 규약이다. 2단계 잠금 규약에서 트랜잭션은 2가지 단계로 잠금을 획득 및 해제한다.

Phase 1은 증가 단계(Growing Phase)로, 트랜잭션이 잠금을 획득하는 단계이다. 트랜잭션은 이 단계에서 필요로 하는 모든 항목들에 대한 락을 얻을 때 까지 기존에 얻었던 락을 해제할 수 없다. 

Phase 2는 감소 단계(Shrinking Phase)로, 트랜잭션이 잠금을 해제하는 단계이다. 이 단계로 들어선다면, 트랜잭션은 새로운 락을 획득할 수 없다. 

트랜잭션은 증가 상태로 시작하여, 필요한 대로 잠금을 얻는다. 그러나 일단 트랜잭션이 잠금을 해제하고 나면 그 트랜잭션은 감소 단계에 돌입하게 되고 더 이상의 잠금을 요청할 수 없다.

트랜잭션이 마지막 잠금을 얻는 부분을 그 트랜잭션의 잠금 지점(Lock Point)라고 부른다. 서로 다른 트랜잭션을 잠금 지점 순서로 정렬할 때, 이 순서가 직렬 가능성 순서라고 볼 수 있다.

2단계 잠금 규약이 교착 상태가 발생하지 않음을 보장하지 않는다.

2단계 잠금은 직렬 가능성의 필요조건은 아니다. 2단계 잠금 규약이 사용되지 않으면서 직렬 가능할 수도 있다. 허나 2단계 잠금 규약이 사용되었다면 항상 직렬 가능하다.