---
상위 개념: "[[MVCC]]"
---
# Snapshot Isolation
스냅샷 고립(Snapshot Isolation)이란 Oracle, PostgreSQL, SQL Server와 같은 상용 시스템이나 오픈 소스 시스템에서 폭넓게 사용되고 있는 동시성 제어 기법의 특별한 형태이다.

개념적으로 스냅샷 고립은 트랜잭션이 실행을 시작하는 시점의 데이터베이스의 "스냅샷"을 그 트랜잭션에 부여하는 과정을 포함하고 있다. 스냅샷을 통해 트랜잭션은 다른 동시 실행 트랜잭션과는 완전히 고립되며 해당 스냅샷에 대해서만 작업을 수행하게 된다. 어떠한 순간의 스냅샷은 커밋한 트랜잭션이 기록한 값으로만 구성되어 있다. 이러한 고립은 읽기 전용 트랜잭션에는 이상적이라고 할 수 있는데, 왜냐하면 절대 대기하거나 동시성 제어 관리자에 의해 중단되지 않기 때문이다.

데이터베이스를 갱신하려는 트랜잭션은 데이터베이스를 갱신하려는 다른 트랜잭션과 충돌할 수 있다. 따라서 갱신 작업의 커밋을 허용하기 전에 검증 과정이 필요하다. 갱신 내용은 그 트랜잭션의 검증이 끝날 때까지 그 트랜잭션의 고유 작업장(workspace)에 유지되며 검증이 끝난 후에 갱신 내용을 데이터베이스에 기록된다.

## 스냅샷 고립의 구현
스냅샷 고립을 구현하기 위해 트랜잭션은 두 개의 타임스탬프를 부여받는다.

1. $StartTS(T_i)$ : 트랜잭션 i가 실행을 시작한 시간
2. $CommitTS(T_i)$ : 트랜잭션이 **검증을 요청한 시간**

데이터 항목을 갱신하려는 트랜잭션은 해당 데이터 항목에 새로운 버전을 생성한다. 이 버전은 버전이 생성된 시점의 시간을 나타내는 하나의 쓰기 타임스탬프만 가지고 있다. 이 타임스탬프는 $CommitTS(T_i)$로 설정된다.

트랜잭션 $T_i$가 데이터 항목을 읽을 때 $StartTS(T_i)$ 보다 작거나 같은 타임스탬프를 가지는 버전 중에서 가장 최신 버전의 값을 반환한다. **따라서 트랜잭션 $T_i$는 $T_i$가 시작한 이후에 커밋한 트랜잭션이 갱신한 내용은 알 수 없지만, $T_i$가 시작하기 전에 커밋한 트랜잭션의 갱신 내용은 알 수 있다.** 이것이 스냅샷의 실체이다.

## 검증 단계
동시에 실행하고 있는 두 트랜잭션은 잠재적으로 같은 데이터 항목을 갱신할 수 있다. 이들은 서로 고립된 상태로 동작하기 때문에 서로의 갱신 내용을 볼 수 없다. 만약 두 트랜잭션 모두에 갱신을 허용한다면, 첫 번째 갱신 내용이 두 번째 갱신 내용으로 덮어씌워질 것이다. 