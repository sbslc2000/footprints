---
상위 개념: "[[Log-based Recovery]]"
---
# Checkpoint
시스템에 장애가 발생하면 로그를 참조하여 재실행할 트랜잭션과 취소할 트랜잭션을 결정해야한다. 이를 위해 로그 전체를 탐색해야하는가? 이는 너무 많은 시간이 소비되고 복구에 너무 많은 리소스를 사용하게 된다. 이러한 부하를 줄이기 위해서 검사점(Checkpoint) 기법을 사용할 수 있다. 

검사점 생성은 다음과 같이 이루어진다.

1. 현재 메인 메모리상에 존재하는 모든 로그 레코드를 안정 저장 장치에 출력한다.
2. 변경된 모든 버퍼 블록을 디스크에 출력한다.
3. 로그 레코드 \<checkpoint L>을 안정 저장 장치에 출력한다. 여기에서 L은 검사점을 생성하는 시점에 동작중이던 트랜잭션의 목록이다.

검사점을 생성하는 동안 트랜잭션이 버퍼 블록이나 로그 레코드를 기록하는 등의 어떠한 갱신 작업도 허용하지 않는다.

시스템 장애가 발생한 후에 시스템은 로그에서 마지막 체크 포인트 레코드를 찾는다. 이후 체크포인트 이후에 커밋 혹은 실패했거나, 체크포인트 이후에 시작된 트랜잭션에 대해서 redo와 undo를 수행한다.

## 로그 레코드의 공간 회수
검사점 로그 레코드에 있는 트랜잭션 집합 L에 대해서, L의 트랜잭션 중 가장 먼저 시작된 $T_i$의 로그 레코드 <$T_i$ start>보다 더 먼저 발생한 로그 레코드들은 더 이상 필요하지 않다. 데이터베이스 시스템은 로그 레코드가 차지하는 공간을 회수할 때 이러한 로그 레코드를 삭제할 수 있다.