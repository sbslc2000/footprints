---
상위 개념: "[[../Recovery System|Recovery System]]"
---
# Log-based Recovery
로그 기반 복구(Log-based recovery)는 로그 레코드를 사용하여 트랜잭션 실패를 복구하고 원자성을 유지하는 방법이다.

트랜잭션이 쓰기 연산을 수행할 때마다 데이터베이스를 변경하기 전에 쓰기 연산을 위한 로그 레코드를 생성하고 로그에 추가해야 한다. 또한 데이터베이스에 이미 반영된 변경 사항을 로그 레코드에 기록된 이전 값을 이용하여 실행 취소 할 수 있다.

> [!warning]
> 트랜잭션이 데이터베이스를 수정한다는 것은 트랜잭션이 디스크 버퍼 또는 디스크 자체를 갱신하는 것을 말한다. 트랜잭션이 단순히 메인 메모리상의 개인 영역에서 데이터 항목을 수정한 것은 데이터베이스를 수정했다고 말하지 않는다.

시스템 장애나 디스크 고장을 복구할 때 로그 레코드를 활요앟기 위해서 로그는 반드시 안정 저장 장치에 있어야 한다.



## 데이터베이스 변경
데이터베이스 수정의 시점에 따라 지연 갱신 기법과 즉시 갱신 기법으로 나누어 볼 수 있다.

* 지연 갱신 기법(Deferred Modification): 트랜잭션이 커밋할 때까지 데이터베이스를 수정하지 않는 방식을 의미한다. 지연 갱신은 모든 갱신한 데이터 항목에 대해 로컬 사본을 유지해야하는 부담이 있다. 또한 데이터를 읽을 때에 만약 자신이 갱신했던 항목이라면 반드시 로컬 사본을 읽어야 한다.
* 즉시 갱신 기법(Immediate Modification): 트랜잭션이 수행하는 도중 데이터베이스 수정을 할 수 있는 방식을 의미한다.

## 트랜잭션 커밋
트랜잭션의 마지막 로그 레코드인 커밋 로그 레코드가 안정 저장 장치에 기록되면 트랜잭션이 커밋했다고 한다. 이는 복구에 필요한 모든 레코드가 이미 안정 저장 장치에 기록되어 있어 다시 되돌릴 수 있는 충분한 정보를 갖게 된다.

## 장애로부터의 회복
만약 로그에 <$T_i$ start> 레코드가 있으며, <$T_i$ commit> 또는 <$T_i$ abort> 레코드가 있는 경우, 트랜잭션 $T_i$는 재실행해야한다. 만약 로그에 <$T_i$ , start> 레코드가 있지만, <$T_i$ commit> 또는 <$T_i$ abort> 레코드가 없는 경우, 트랜잭션 $T_i$는 취소되어야 한다. 