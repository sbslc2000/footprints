
```dataviewjs
dv.span("** ğŸ˜Š Tracker  ğŸ˜¥**") /* optional â¹ï¸ğŸ’¤âš¡âš ğŸ§©â†‘â†“â³ğŸ“”ğŸ’¾ğŸ“ğŸ“ğŸ”„ğŸ“ğŸ”€âŒ¨ï¸ğŸ•¸ï¸ğŸ“…ğŸ”âœ¨ */
const calendarData = {
    year: 2023,  // (optional) defaults to current year
    colors: {    // (optional) defaults to green
        blue:        ["#8cb9ff", "#69a3ff", "#428bff", "#1872ff", "#0058e2"], // first entry is considered default if supplied
        green:       ["#c6e48b", "#7bc96f", "#49af5d", "#2e8840", "#196127"],
        red:         ["#ff9e82", "#ff7b55", "#ff4d1a", "#e73400", "#bd2a00"],
        orange:      ["#ffa244", "#fd7f00", "#dd6f00", "#bf6000", "#9b4e00"],
        pink:        ["#ff96cb", "#ff70b8", "#ff3a9d", "#ee0077", "#c30062"],
        orangeToRed: ["#ffdf04", "#ffbe04", "#ff9a03", "#ff6d02", "#ff2c01"]
    },
    showCurrentDayBorder: true, // (optional) defaults to true
    defaultEntryIntensity: 1,   // (optional) defaults to 4
    intensityScaleStart: 0,    // (optional) defaults to lowest value passed to entries.intensity
    intensityScaleEnd: 3,     // (optional) defaults to highest value passed to entries.intensity
    entries: [],                // (required) populated in the DataviewJS loop below
}




//DataviewJS loop
for (let page of dv.pages('"TIL"').where(p => p.hello)) {
    //dv.span("<br>" + page.file.name) // uncomment for troubleshooting
    calendarData.entries.push({
        date: page.file.name,     // (required) Format YYYY-MM-DD
        intensity: page.hello, // (required) the data you want to track, will map color intensities automatically
        content: "",           // (optional) Add text to the date cell
        color: "green",          // (optional) Reference from *calendarData.colors*. If no color is supplied; colors[0] is used
        
    })
}

renderHeatmapCalendar(this.container, calendarData)
```

# Spring Data JPA
## Projection
ì¼ë¶€ë¶„ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë§Œ select í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ 
ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ê³¼ í´ë˜ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆìœ¼ë©°, ì´ë“¤ì€ ê°ê° Open í”„ë¡œì ì…˜ ë°©ì‹ê³¼ Closed í”„ë¡œì ì…˜ ë°©ì‹ì´ ìˆë‹¤. **Open Projection**ì€ ì¼ë‹¨ ë‹¤ ê°€ì ¸ì˜¨ ì´í›„ ë³´ê³ ì‹¶ì€ ê²ƒë§Œ í•„í„°ë§í•˜ëŠ” ê²ƒì´ë©°, **Closed Projection**ì€ ìµœì´ˆì— ê°€ì ¸ì˜¬ ë•Œë¶€í„° í•„ìš”í•œ ì •ë³´ë§Œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ë‹¤.
### ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ í”„ë¡œì ì…˜
* closed projection
ì•„ë˜ëŠ” ê´€ì‹¬ìˆëŠ” í•„ë“œì˜ ì •ë³´ë§Œì„ ê°€ì ¸ì˜¤ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.
```java
public interface CommentSummary {
	String getComment();
	int getUp();
	int getDown();
}
```

```java
public interface CommentRepository extends JpaRepository<Comment,Long> {
	...
	List<CommentSummary> findByPost_id(Long id);
}
```
ì´ ê²½ìš° SQLë„ í•„ìš”í•œ ì»¬ëŸ¼ë§Œì„ ê°€ì ¸ì˜¤ë„ë¡ ë³€ê²½ëœë‹¤.

* open projection
ì•„ë˜ì²˜ëŸ¼ ì‚¬ìš©í•˜ë©´ ì¼ë‹¨ targetì— ëŒ€í•œ ì •ë³´ë¥¼ ê°€ì ¸ì™€ì•¼í•˜ê¸° ë•Œë¬¸ì— ëª¨ë“  ì»¬ëŸ¼ì„ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤.
```java
public interface CommentSummary {
	String getComment();
	int getUp();
	int getDown();

	@Value("#{target.up ' ' + target.down}")
	String getVotes();
}
```

ìœ„ì™€ ê°™ì´ ì¡°í•©ëœ ì»¬ëŸ¼ì„ ì‚¬ìš©í•˜ë©´ì„œ closed projectionì„ í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ í•˜ë©´ ëœë‹¤.
```java
public interface CommentSummary {
	String getComment();
	int getUp();
	int getDown();

	String getVotes() {
		return getUp() + " " + getDown();
	}
}
```

### í´ë˜ìŠ¤ ê¸°ë°˜ í”„ë¡œì ì…˜

* closed projection
```java
public class CommentSummary {
	private String comment;
	private int up;
	private int down;

	public CommentSummary(String comment, int up, int down) {
		this.comment = comment;
		this.up = up;
		this.down = down;
	}
	
	public String getComment();
	public int getUp();
	public int getDown();

	String getVotes() {
		return getUp() + " " + getDown();
	}
}
```

ì´ë ‡ê²Œ í•˜ë©´ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ closed projectionì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ì´ ë°©ì‹ì€ ì¸í„°í˜ì´ìŠ¤ì— ë¹„í•˜ì—¬ ë§ì€ ì½”ë“œê°€ ë“¤ì–´ê°€ëŠ” ë°˜ë©´ íš¨ê³¼ëŠ” ë™ì¼í•˜ë¯€ë¡œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì“°ëŠ” ê²ƒì´ ë” ë‚˜ì„ì§€ë„ ëª¨ë¥´ê² ë‹¤.

### ì—¬ëŸ¬ê°œì˜ íƒ€ì…ì„ ì²˜ë¦¬í•´ì•¼í•œë‹¤ë©´
ë§Œì•½ ì—¬ëŸ¬ê°œì˜ í´ë˜ìŠ¤(í˜¹ì€ ì¸í„°í˜ì´ìŠ¤)ë¥¼ ì²˜ë¦¬í•´ì•¼í•  ë•Œ ì–´ë–»ê²Œ í•˜ë©´ ì¢‹ì„ê¹Œ?
```java
public interface CommentRepository extends JpaRepository<Comment,Long> {
	...
	List<CommentSummary> findByPost_id(Long id);
	List<CommentOnly> findByPost_id(Long id); //compile error
}
```

ì´ë•ŒëŠ” Genericì„ ì‚¬ìš©í•˜ì—¬ ìœ ì—°í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. -> **Dynamic Projection**
```java
public interface CommentRepository extends JpaRepository<Comment,Long> {
	...
	//ëŒ€ì‹  íŒŒë¼ë¯¸í„°ë¡œ íƒ€ì…ì„ ë„˜ê²¨ì•¼í•œë‹¤.
	<T> List<T> findByPost_id(Long id, Class<T> type);
}
```

## Specification
Specificationì€ DDD ì±…ì—ì„œ ì–¸ê¸‰ë˜ëŠ” ê°œë…ìœ¼ë¡œ Querydslì˜ Predicateì™€ ìœ ì‚¬í•˜ë‹¤.

### ì„¤ì •í•˜ëŠ” ë°©ë²•
* jpa-model-generator ì¶”ê°€

ì–´ìš° êµ¬ë²„ì „

## Query By Example
QBEëŠ” í•„ë“œ ì´ë¦„ì„ ì‘ì„±í•  í•„ìš” ì—†ì´ ë‹¨ìˆœí•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ë™ì ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ë§Œë“œëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ì‚¬ìš©ì ì¹œí™”ì ì¸ ì¿¼ë¦¬ ê¸°ìˆ ì…ë‹ˆë‹¤.

```java
Comment prove = new Comment();
prove.setBest(true);

//ê¸°ë³¸ì ìœ¼ë¡œëŠ” ëª¨ë“  í•„ë“œë¥¼ ë¹„êµí•˜ì—¬ ê°€ì ¸ì˜¤ì§€ë§Œ, ì—¬ëŸ¬ ë©”ì„œë“œë¥¼ í†µí•´ ì ìš©ë  í”„ë¡œí¼í‹°ë¥¼ í•œì •í•  ìˆ˜ ìˆë‹¤.
ExampleMatcher.matching()
	.withIncludeNullValues()
	.withMatcher("best", isTrue());

```

ë‹¨ì 
* í”„ë¡œí¼í‹° ê·¸ë£¹ì— ëŒ€í•œ ì œì•½ì¡°ê±´ì„ ë§Œë“¤ì§€ ëª»í•œë‹¤.
* ë²”ìœ„ ê°’ ì¡°íšŒë¥¼ í•˜ì§€ ëª»í•œë‹¤.

## Auditing
ì—”í‹°í‹°ì˜ ë³€í™”ê°€ ë‚˜íƒ€ë‚¬ì„ ë•Œ, ì´ê²ƒì´ ì–¸ì œ ëˆ„êµ¬ë¡œë¶€í„° ë³€ê²½ëëŠ”ì§€ ê¸°ë¡í•˜ëŠ” ë°©ë²•

```java
public class Comment {

	@CreatedAt
	private Date createdAt;

	@CreatedBy
	@ManyToOne
	private Account createdBy;

	@LastModifiedDate
	private Date createdAt;

	@LastModifiedBy
	@ManyToOne
	private Account createdBy;
}
```

Auditingì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì• ë…¸í…Œì´ì…˜ì„ ì‘ì„±í•´ì£¼ì–´ì•¼ í•œë‹¤.

```java
@SpringBootApplication
@EnableJpaAuditing
public class Application {
...
}
```

Entityì—ëŠ” AuditingListenerë¥¼ ì„¤ì •í•´ì£¼ì–´ì•¼ í•œë‹¤.
```java
@Entity
@EntityListeners(AuditingEntityListener.class)
public class Comment { ... }
```

ì´ì œ DateëŠ” ì•Œì•„ì„œ ê°±ì‹ ëœë‹¤. í•˜ì§€ë§Œ AccountëŠ” ì–´ë–»ê²Œ ì—…ë°ì´íŠ¸ì‹œì¼œì•¼ í• ê¹Œ?
Spring Securityë¥¼ ì‚¬ìš©í•˜ë©´ AuditAwareë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ì—¬ ìˆ˜ì •,ìƒì„± ì‹œì˜ ì‚¬ìš©ìë¥¼ ë°˜í™˜í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
```java
public class AccountAuditAware implements AuditorAware<Account> {
	@Override
	public Optional<Account> getCurrentAuditor() {
		Authentication authentication = SecurityContextHolder.getContext().getAuthentication();

		return (MyUserDetails) authentication.getPrincipal().getUser();
	}
}
```

ì´ ê²½ìš° ë“±ë¡ëœ ë¹ˆì˜ ì´ë¦„ì„ ì„¤ì •ì—ì„œ ì œê³µí•´ì£¼ì–´ì•¼ í•œë‹¤.
```java
@SpringBootApplication
@EnableJpaAuditing(autidotorAwareRef = "accountAuditAware")
```


### Jpaì˜ Lifecycle Eventë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
Jpa ì—”í‹°í‹°ì˜ lifecycle ê°„ì—ëŠ” ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ì—¬ ì½œë°± ë©”ì„œë“œë¥¼ ìˆ˜í–‰ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

```java
@Entity 
class Post {

	@PrePersist
	public void prePersist() {
		this.createdAt = new Date();
		this.createdBy = //ThreadLocalì„ í†µí•´ ìœ ì € ê°€ì ¸ì˜¤ê¸°
	}
}
```

@PreUpdate, @PrePersist ë“±ì„ ì‚¬ìš©í•˜ì—¬ ìƒì„±ì‹œ, ìˆ˜ì •ì‹œ í•„ìš”í•œ ê°’ë“¤ì„ ë„£ì„ ìˆ˜ ìˆë‹¤. 