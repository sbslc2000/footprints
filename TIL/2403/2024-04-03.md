# @Profile 
만약 각 환경마다 서로 다른 빈을 등록해야 한다면 어떻게 해야할까?

스프링은 @Profile 애노테이션을 통해 환경별로 빈 등록을 제어할 수 있다.

## 사용방법
```java
@Slf4j  
@Configuration  
public class PayConfig {  
  
    @Bean  
    @Profile("default")  
    public LocalPayClient localPayClient() {  
        log.info("localPayClient() called");  
        return new LocalPayClient();  
    }  
  
    @Bean  
    @Profile("prod")  
    public ProdPayClient prodPayClient() {  
        log.info("prodPayClient() called");  
        return new ProdPayClient();  
    }  
}
```
위 설정 클래스를 통해 기본 프로필에서는 LocalPayClient가, prod 환경에서는 ProdPayClient가 등록된다.

## 동작원리
Profile 애노테이션은 @Conditional() 애노테이션의 합성 애노테이션이다.
```java
@Target({ElementType.TYPE, ElementType.METHOD})  
@Retention(RetentionPolicy.RUNTIME)  
@Documented  
@Conditional(ProfileCondition.class)  
public @interface Profile {  
  
    /**  
     * The set of profiles for which the annotated component should be registered.     */    String[] value();  
  
}
```

ProfileCondition은 environment를 통해 프로필을 조회하고 주어진 value와 같은지를 검증하여, 빈 등록 여부를 결정한다.
```java
class ProfileCondition implements Condition {  
  
    @Override  
    public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {  
       MultiValueMap<String, Object> attrs = metadata.getAllAnnotationAttributes(Profile.class.getName());  
       if (attrs != null) {  
          for (Object value : attrs.get("value")) {  
             if (context.getEnvironment().acceptsProfiles(Profiles.of((String[]) value))) {  
                return true;  
             }  
          }  
          return false;  
       }  
       return true;  
    }  
  
}
```

# 액츄에이터
# 프로덕션 준비 기능
'전투에서 실패한 지휘관은 용서할 수 있지만, 경계에서 실패하는 지휘관은 용서할 수 없다.' 라는 말이 있다. 장애는 언제든지 발생할 수 있지만, 모니터링(경계)는 잘 대응하는 것이 중요하다.

개발자가 애플리케이션을 개발할 때에는 기능 요구사항만 하는 것이 아니다. 서비스를 실제 운영 단계에 올리게 되면 개발자들이 해야하는 또 다른 주요한 업무가 있다. 바로 서비스에 문제가 없는지 모니터링하고 지표들을 심어서 감시하는 활동이다.

운영 환경에서 필요한 이런 기능들을 프로덕션 준비 기능이라고 한다. -- 프로덕션을 운영에 배포할 때 준비해야하는 비 기능적인 요소

* 지표(metric) : cpu 사용량 등
* 추적(trace) : 애플리케이션 코드가 어디서 문제가 되나, 어떤 루트로 호출이 되나
* 감사(auditing) : 로그인, 로그아웃 등의 이력
* 모니터링 : 전체적인 지표들에 대한 문제점들을 확인하는 행동

스프링부트가 제공하는 액츄에이터는 프로덕션 준비 기능을 편리하게 사용할 수 있는 다양한 편의 기능들을 제공한다. 더 나아가서 마이크로미터, 프로메테우스, 그라파나 같은 최근 유행하는 모니터링 시스템과 매우 쉽게 연동할 수 있는 기능도 제공한다.