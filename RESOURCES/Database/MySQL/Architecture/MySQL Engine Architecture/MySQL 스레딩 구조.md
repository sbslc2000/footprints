# MySQL 스레딩 구조

MySQL 서버는 스레드 기반으로 동작하며, 크게 Foreground Thread와 Background Thread로 구분할 수 있다.

## Foreground Thread
포그라운드 쓰레드는 최소한 MySQL 서버에 접속된 클라이언트의 수 만큼 존재하며, 주로 각 클라이언트 사용자가 요청하는 쿼리 문장을 처리한다. 포그라운드 쓰레드는 데이터 캐시 영역에서 데이터를 가져오거나, 직접 디스크의 데이터나 인덱스 파일로부터 데이터를 읽어와 작업을 처리할 수 있다.

InnoDB의 경우 데이터 버퍼까지만 포그라운드 서비스가 처리하고 디스크 접근은 백그라운드 쓰레드에 위임하며, MyISAM의 경우는 포그라운드 쓰레드가 직접 디스크에 접근하여 작업을 처리한다.

### Thread Cache
커넥션이 종료되면 포그라운드 쓰레드는 바로 release 되지 않는다. thread_cache_size는 포그라운드 스레드로 사용되기 위해서 대기할 쓰레드의 개수를 결정하며, 만약 종료 시점에 thread cache에 있는 쓰레드 개수가 thread_cache_size보다 작다면 쓰레드는 종료되지 않고 캐시로 되돌아가며, thread_cache_size만큼 쓰레드가 대기중이라면 쓰레드는 종료된다. 

이를 통해  유휴상태에서 최소 thread_cache_size만큼의 스레드는 사용자를 위해 대기하고 있을 수 있게 만들 수 있다.

## Background Thread
백그라운드 쓰레드는 다음과 같이 여러 가지 작업을 처리한다.

* Insert Buffer를 병합
* 로그를 디스크로 기록
* InnoDB 버퍼 풀의 데이터를 디스크에 기록
* 데이터를 버퍼로 읽어 오기
* 잠금이나 데드락을 모니터링