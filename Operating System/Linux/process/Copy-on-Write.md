---
상위 개념: "[[Linux Process]]"
---
# Copy-on-Write
Copy-on-Write는 리눅스가 fork()를 구현할 때 최적화를 위해 사용하는 기법이다.

전통적으로 fork()가 호출되면, 부모가 보유한 모든 자원을 자식에게 복제하여 넘긴다. 이는 어쩌면 그냥 공유해도 될만한 많은 데이터들을 불필요하게 복사하게되므로 비효율적이다. 더구나 자식 프로세스가 곧바로 새로운 실행 이미지를 실행(exec)한다면, 복사는 낭비가 된다.

리눅스는 fork()를 구현할 때 페이지 단위의 COW 기법을 사용한다. COW 기법은 데이터를 즉시 복사하지 않고, 가능하면 복사를 늦추거나 아예 피하는 기법이다. 자식 프로세스를 위한 주소 공간을 곧바로 생성하는 대신, 부모와 자식이 동일한 물리 데이터를 공유하되 읽기 전용으로 표시해 둔다.

이후 해당 페이지에 쓰기 동작이 발생하면 그 순간에 사본을 만들어, 각 프로세스가 자신만의 복사본을 갖도록 만든다. 즉, 실제 복사는 쓰기가 일어날 때만 수행되고, 그 전까지는 공유가 유지된다. fork() 직후 exec()을 호출하는 자식 프로세스라면, 기존 페이지에 쓰는 일이 없고 따라서 끝내 복사되지 않는다.

따라서 fork()에 드는 실질적 오버헤드는 부모의 페이지 테이블을 복제하는 비용과 자식의 고유한 프로세스 디스크립터를 만드는 비용 정도로 줄어든다.