---
상위 링크: "[[../Data Link Layer]]"
---
# Ethernet
thernet은 로컬 영역 네트워크(LAN)에서 장치 간 데이터를 효율적이고 안정적으로 전송하기 위해 설계된 기술이다. 여러 호스트가 하나의 링크를 공유할 때 발생하는 충돌 문제를 해결하기 위해 매체 접근 제어(Medium Access Control, MAC) 기법을 포함하고 있다.

## Bus Topology
![](https://i.imgur.com/QR265ri.png)

고전적인 이더넷은 하나의 물리 회선을 여러 호스트가 공유하는 LAN 환경을 전제로 설계되었다. 대표적인 구조는 버스형 토폴로지이며, 하나의 동축 케이블을 따라 여러 장치를 직렬로 연결하는 방식이다.

이 구조의 특징은 다음과 같다:
- 하나의 케이블을 통해 모든 장치가 데이터를 송수신한다.
- 한 호스트가 데이터를 전송하면, 같은 회선 위의 모든 장치가 신호를 수신한다.
- 둘 이상의 호스트가 동시에 전송하면 신호가 겹쳐 충돌이 발생한다.
    
이처럼 회선을 공유하는 구조에서는 동시에 여러 장치가 데이터를 보내려는 경쟁 상황이 자연스럽게 발생하며, 이러한 환경을 [다중 접근 환경](Multiple%20Access)이라 한다. 이로 인해 충돌 발생 가능성이 항상 존재하며, 이를 효과적으로 관리하는 매체 접근 제어 알고리즘이 필요하다.

## CSMA/CD

### Carrier Sense
반송파 감지(Carrier Sense)란 이더넷 랜카드가 데이터를 송신하기 전 회선에 신호가 흘러가고 있는지 미리 검사하는 행위를 뜻한다. 만약 회선이 유휴 상태라면 데이터를 즉시 전송하고, 회선이 다른 호스트에 의해 사용중이라면 유휴 상태가 될 때까지 기다렸다가 즉시 전송한다.

### Collision Detect
CS를 통해 유휴 상태의 회선에 데이터를 전송하기로 결정하였더라도, 회선의 상태를 점검한다. 서로 다른 호스트에서 CS를 거의 동일한 시간에 수행하고 데이터를 전송하겠다는 결정을 한다면 충돌이 일어날 수 있기 때문이다. 이 행위를 **충돌 감지**(Collision Detect)라고 한다.

충돌이 발생했다는 것은 전압을 체크하는 것으로 쉽게 감지할 수 있다. 만약 전압에 이상이 생긴 경우, 충돌이 발생한 것으로 간주하고 충돌이 발생했다는 의미의 '잼' 신호를 보낸 뒤 프레임 전송을 멈춘다. 

프레임 전송을 멈춘 다음 각 호스트들은 재전송을 위한 대기 시간(backoff interval)을 선택한다. 이때 사용하는 방법이 바로 **이진 지수 백오프(binary exponential backoff)**이다. 충돌이 발생한 횟수를 기준으로 백오프 간격을 점점 늘려가면서 재전송 시도를 분산시킨다.

구체적으로, 각 호스트는 다음과 같이 동작한다:

- 충돌 횟수를 k라 하면, 호스트는 0부터 $2^k - 1까지의 범위 중 무작위로 하나를 선택한다.  
- 선택된 값에 슬롯 타임(slot time)을 곱하여 대기 시간을 결정한다.
- 슬롯 타임은 네트워크의 최대 전파 지연을 고려하여 정해지는 최소 시간 단위이다.
- 대기 시간이 지난 후, 다시 carrier sensing을 수행하여 채널이 비어 있으면 전송을 재시도한다.

이진 지수 백오프는 반복 충돌을 줄이면서, 네트워크 혼잡이 심해질수록 자연스럽게 재전송 시도를 분산시키는 역할을 한다. 일반적으로 k 값은 일정 최대값(예: 10회 또는 16회 충돌)까지 제한되며, 이 횟수를 초과하면 프레임 전송을 포기한다.





그런데, 충돌 감지는 전송하는 모든 순간에 해야하나? 사실은 그렇지는 않다. 모든 회선을 전송하는 신호가 덮는다면,  그 이후에는 다른 호스트들이 CS에 의하여 전송을 하지 않을 것이므로, 더 이상 충돌이 발생하지 않고 따라서 감지할 필요가 없다. 결국 회선을 덮을 수 있을 정도의 시간 동안은 충돌 감지를 해야한다.

IEEE 802.3 표준에서 동축 케이블 기반 이더넷은 최대 5개의 세그먼트와 4개의 중계기, 그리고 동축 케이블의 총 길이는 2500m를 넘지 않게 해야한다고 결정했다. 이는 신호 감쇠와 전파지연시간 등을 고려해서 결정한 내용들이다. 결국 신호가 회선을 다 덮었는지에 확신할 수 있는 시간을 따지려면 위 규칙 내에서 최악의 상황을 고려해야한다.

![430ZVFq.png](https://i.imgur.com/430ZVFq.png)

이더넷에서 노드 A와 노드 B가 네트워크의 양 끝에 위치한 상황을 가정해보자. 노드 A가 데이터를 송신하고 노드 B가 이를 수신하기까지는 시간이 걸리며, 그동안 노드 B는 A가 데이터를 송신 중이라는 사실을 알 수 없다. 이로 인해 노드 B가 데이터를 송신할 경우, 네트워크 상에서 충돌이 발생할 가능성이 높아진다. 특히, A가 송신한 프레임의 크기가 매우 작다면 문제는 더욱 심각해진다. A의 프레임이 네트워크를 따라 전파되다가, B의 프레임과 충돌한 이후에 위치한 다른 노드들에게는 손상된 상태로 전달될 수 있다.

이 문제를 해결하기 위해 이더넷은 네트워크의 가장 먼 노드까지 신호가 전파되었다가 돌아오는 시간(왕복 전파 시간, RTT) 동안 충돌을 감지할 수 있어야 한다는 원칙을 설정하였다. 이를 보장하기 위해 **최소 프레임 크기**가 정의되었다. 최소 프레임 크기는 송신 노드가 신호를 전송하는 동안 충돌이 발생하더라도 이를 감지하고 적절히 대응할 수 있는 시간을 확보하기 위해 설정된 것이다. 이 기준에 따라 이더넷의 최소 프레임 크기는 64바이트(헤더 포함)로 규정되어 있으며, 이는 충돌 감지가 제대로 이루어질 수 있도록 충분한 송신 시간을 보장한다.
