---
상위 개념: "[[Generalized Forwarding]]"
---
# OpenFlow
OPenFlow\[McKeown 2008, ONF 2020, Casado 2014, Tourrilhes 2014]은 '매치 플러스 액션' 포워딩의 개념화 및 컨트롤러 그리고 SDN 혁명의 개념을 개척한 매우 가시적인 표준이다. 이는 명확하고 간결한 방식으로 SDN 개념과 기능을 도입했다.

# OpenFlow 1.0

## Flow table
OpenFlow에서 '플로우 테이블'로 불리는 '매치 플러스 액션' 포워딩 테이블의 엔트리는 다음을 포함한다. 플로우 테이블은 본질적으로 API이며 개별 패킷 스위치의 동작을 프로그래밍할 수 있는 개념이다.

* 매치를 위해 사용되는 패킷의 헤더값들의 세트
* 패킷들에 의해 갱신되는 카운터 세트
* 매치가 되었을 때 행해질 동작

## Match
![](https://i.imgur.com/K5BG9ua.png)
위 그림은 OpenFlow 1.0에서 매치될 수 있는 11개의 패킷 헤더 필드와 수신 포트 ID를 보여준다.

플로우 테이블은 2계층부터 4계층까지의 헤더를 조사하여 매치한다. 따라서 이는 계층화 원칙을 무시한다. 이는 OpenFlow 지원 장치가 3계층 라우터 뿐만 아니라 2계층 스위치에서도 사용될 수 있음을 시사한다.

플로우 테이블 엔트리에는 와일드카드도 있을 수 있다. 예를 들어 IP Src에 128.119.\*.\* 값이 있다면, 128.119를 주소의 첫번째 16비트로 갖는 데이터그램과 매치된다. 또한 각 플로우 테이블 엔트리에는 관련 우선순위가 있다. 패킷이 여러 플로우 테이블 엔트리와 매치되면, 선별된 매치 엔트리에 해당하는 패킷이 엔트리의 가장 높은 우선순위가 된다.

매치 기능은 IP 헤더의 모든 필드에 대해 사용할 수 없다. 예를 들어 OpenFlow는 TTL 필드나 데이터그램 길이 필드에 기반한 매치를 허용하지 않는다. <- 복잡해서

## Action
각 플로우 테이블 엔트리는 플로우 테이블 엔트리와 매치되는 패킷 처리를 결정하는 0개 이상의 액션 목록을 갖고 있다. 여러 액션이 있는 경우 목록에 지정된 순서로 수행된다.

가장 중요한 액션들은 다음과 같다.

* 포워딩 : 매치된 패킷을 특정 출력 포트로 전달하거나, 모든 출력 포트로 브로드캐스팅하거나, 선택된 포트 집합에 대해 멀티캐스팅될 수 있다. 패킷은 캡슐화되어 원격 컨트롤러로 전송될 수 있으며, 컨트롤러는 이를 처리할 수 잇는 새 플로우 테이블 엔트리를 설치할 수 있다.
* 삭제 : 아무 액션이 없는 플로우 테이블 엔트리는 매치된 패킷을 삭제해야함을 나타낸다.
* 필드 수정 : 패킷이 출력 포트로 전달되기 전에 10개의 패킷 헤더 필드의 값을 다시 쓸 수 있다.

## Example
![](https://i.imgur.com/yeQbKfi.png)
위 엔트리는 IP의 목적지 주소가 51.6.0.8인 패킷에 대해 6번 출력 포트로 포워딩하도록 만든다. 이는 목적지 기반 포워딩과 동일하게 동작한다.

![](https://i.imgur.com/dVHuuy4.png)
위 엔트리는 TCP의 22번 포트로 들어오는 모든 요청에 대해 처리를 하지 않게 만든다. 이는 방화벽처럼 동작한다.

![](https://i.imgur.com/C0BmPUv.png)

위와 같은 네트워크가 있다고 가정해보자.

간단한 예로, h6에서 h4로 보내는 패킷이 s3 -> s1 -> s2 를 경유한다고 해보자. 이 때 s1의 플로우 테이블에는 다음과 같은 엔트리가 있어야 한다.

			Match                                           | Action
			Ingress Port=1;IP Src=10.3.*.*;IP Dest=10.2.*.* | Forward(4) 

라우터 s2에는 다음과 같은 엔트리가 있어야 목적지로 전송할 수 있다.

			Match                           | Action
			Ingress Port=2;IP Dest=10.2.0.3 | Forward(3)
			Ingress Port=2;IP Dest=10.2.0.4 | Forward(4)

로드 밸런싱을 하려면 어떻게 할까? h3에서 10.1.\*.\*으로 향하는 데이터그램이 s2와 s1 사이의 링크를 통해 전달되는 반면, h4에서 10.0.\*.\*로의 데이터그램은 s2와 s3 사이의 링크를 통해 전달되는 로드 밸런싱 시나리오를 고려해보자. 

이 경우 s2의 플로우 테이블은 다음과 같아야 한다.

			Match                           | Action
			Ingress Port=3;IP Dest=10.1.*.* | Forward(2)
			Ingress Port=4;IP Dest=10.1.*.* | Forward(1)