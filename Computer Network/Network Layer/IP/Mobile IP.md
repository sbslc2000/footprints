---
상위 링크: "[[Internetworking Protocol]]"
---
# Mobile IP
Mobile IP는 오늘날 인터넷 아키텍처에서 모바일 호스트로 패킷을 라우팅하는 문제를 해결하기 위한 주요 메커니즘입니다. 이는 몇 가지 새로운 기능을 도입하지만, 비(非)모바일 호스트나 대부분의 라우터를 변경하지 않아도 되므로 점진적으로 배포가 가능합니다.

모바일 호스트는 **홈 주소**(Home Address) 라 불리는 영구적인 IP 주소를 가진다고 가정됩니다. 이 주소는 호스트의 **홈 네트워크와 동일한 네트워크 프리픽스**를 갖습니다. 다른 호스트가 모바일 호스트로 처음 패킷을 보낼 때는 이 주소를 사용합니다. 이 주소는 변하지 않기 때문에, 모바일 호스트가 이동하더라도 장기간 실행되는 애플리케이션에서 계속 사용할 수 있습니다. 이는 호스트의 **장기적인 식별자**로 간주할 수 있습니다.

호스트가 홈 네트워크를 떠나 새로운 외부 네트워크로 이동하면, DHCP와 같은 방법을 통해 해당 네트워크에서 새로운 IP 주소를 할당받습니다. 이 새로운 주소는 호스트가 이동할 때마다 변경되므로, 이를 **호스트의 위치를 나타내는 Locator**로 간주할 수 있습니다. 하지만 중요한 점은, **호스트가 외부 네트워크에서 새로운 주소를 얻더라도 자신의 영구적인 홈 주소를 잃지 않는다는 것입니다**. 이 홈 주소는 호스트가 이동 중에도 통신을 유지할 수 있는 핵심적인 요소입니다.

> DHCP는 Mobile IP가 개발되던 시기와 비슷한 시기에 만들어졌기 때문에, 초기 Mobile IP 표준에서는 DHCP를 필수로 요구하지 않았습니다. 하지만 오늘날 DHCP는 널리 사용되고 있습니다.

대부분의 라우터는 변경되지 않지만, 이동성을 지원하려면 적어도 하나의 라우터에 새로운 기능이 필요합니다. 이 라우터는 모바일 노드의 **홈 에이전트***Home Agent* 로 알려져 있으며, 모바일 호스트의 홈 네트워크에 위치합니다. 경우에 따라 두 번째 라우터가 필요하며, 이는 **포린 에이전트***Foreign Agent* 라고 불립니다. 이 라우터는 모바일 노드가 홈 네트워크를 벗어나 연결된 네트워크에 위치합니다. 먼저, 포린 에이전트를 사용하는 Mobile IP의 동작 방식을 살펴보겠습니다. 홈 에이전트와 포린 에이전트가 모두 있는 네트워크의 예는 그림 2에 나타나 있습니다.

홈 에이전트와 포린 에이전트는 **에이전트 광고 메시지***Agent Advertisement Messages*를 사용하여 자신이 연결된 네트워크에서 주기적으로 자신의 존재를 알립니다. 모바일 호스트는 새로운 네트워크에 연결되었을 때 광고 메시지를 요청_Solicit_할 수도 있습니다. 홈 에이전트의 광고는 모바일 호스트가 홈 네트워크를 떠나기 전에 자신의 홈 에이전트의 주소를 알 수 있도록 합니다.

모바일 호스트가 외부 네트워크(포린 네트워크)에 연결되면, 포린 에이전트로부터 광고 메시지를 수신하고 해당 에이전트와 등록_Register_합니다. 이 과정에서 모바일 호스트는 **홈 에이전트의 주소를 포린 에이전트에 제공**합니다. 이후, 포린 에이전트는 홈 에이전트에 COA *Care-of Address*를 전달합니다. 이 COA는 일반적으로 포린 에이전트의 IP 주소입니다.

이 시점에서, 모바일 호스트로 패킷을 보내려는 호스트는 모바일 호스트의 홈 주소를 목적지 주소로 사용해 패킷을 전송한다는 것을 알 수 있습니다. 일반적인 IP 포워딩 메커니즘에 의해 이 패킷은 모바일 노드의 홈 네트워크에 위치한 홈 에이전트로 도달합니다. 따라서, 모바일 노드로 패킷을 전달하는 문제를 다음 세 가지로 나눌 수 있습니다

1. 홈 에이전트는 모바일 노드로 향하는 패킷을 어떻게 가로채는가?
2. 홈 에이전트는 이 패킷을 포린 에이전트로 어떻게 전달하는가?
3. 포린 에이전트는 이 패킷을 모바일 노드로 어떻게 전달하는가?

![](https://i.imgur.com/N6Inexj.png)

첫 번째 문제는 Figure 2를 보면 단순해 보일 수 있습니다. 그림에서는 홈 에이전트가 분명히 송신 호스트와 홈 네트워크 간의 유일한 경로로 나타나므로, 모바일 노드로 향하는 패킷을 반드시 수신하게 되어 있습니다. 하지만 송신 호스트(상대 노드)가 네트워크 18에 있거나 (내부 통신으로 라우터를 거치지 않는 경우), 네트워크 18에 연결된 또 다른 라우터가 패킷을 홈 에이전트를 거치지 않고 전달하려 한다면 어떻게 될까요?

이 문제를 해결하기 위해 홈 에이전트는 **프록시 ARP***Proxy ARP*라는 기술을 사용해 모바일 노드의 역할을 대신합니다. 이는 일반적인 ARP과 유사하지만, 홈 에이전트는 ARP 메시지에 **자신의 IP 주소 대신 모바일 노드의 IP 주소를 삽입**합니다. 또한, 홈 에이전트는 자신의 하드웨어 주소를 사용하므로, 같은 네트워크에 있는 모든 노드는 홈 에이전트의 하드웨어 주소를 모바일 노드의 IP 주소와 연관시킵니다. (이 경우, 모바일 노드로 보내고자하는 네트워크 18에 있는 노드의 경우 모바일 노드의 IP 주소로 보내면, 홈 에이전트에게 감)

두 번째 문제는 가로챈 패킷을 포린 에이전트로 전달하는 것입니다. 여기에서는 앞서 설명된 **터널링 기법**을 사용합니다. 홈 에이전트는 패킷을 IP 헤더로 감싸고 이 헤더의 목적지를 포린 에이전트로 설정한 뒤, 이를 인터넷으로 전송합니다. 이 과정에서 중간에 있는 라우터들은 **단순히 포린 에이전트의 IP 주소로 향하는 IP 패킷으로 인식하여 전달합니다.** 이를 달리 표현하면, 홈 에이전트와 포린 에이전트 간에 **IP 터널**이 생성된 것이며, 홈 에이전트는 모바일 노드로 향하는 패킷을 해당 터널에 “투입”한다고 볼 수 있습니다.

패킷이 포린 에이전트에 도착하면, 포린 에이전트는 추가된 IP 헤더를 제거하고, 안에 들어 있는 모바일 노드의 홈 주소를 목적지로 하는 IP 패킷을 확인합니다. **하지만 포린 에이전트는 이를 일반적인 IP 패킷으로 처리하면 안 됩니다. 그렇게 하면 이 패킷이 다시 홈 네트워크로 전송될 수 있기 때문입니다.** 대신, 포린 에이전트는 해당 주소가 **등록된 모바일 노드의 주소**임을 인식하고, 등록 과정에서 학습한 모바일 노드의 하드웨어 주소(예: 이더넷 주소)로 패킷을 전달합니다.

이 절차에서 주목할 점은 **포린 에이전트와 모바일 노드가 동일한 장치에 존재할 수 있다는 것**입니다. 즉, 모바일 노드가 스스로 포린 에이전트의 역할을 수행할 수 있습니다. 이를 가능하게 하려면 모바일 노드가 동적으로 포린 네트워크 주소 공간에 속하는 IP 주소를 획득할 수 있어야 합니다(예: DHCP를 사용). 이 주소는 COA로 사용됩니다. 이 접근 방식은 포린 에이전트가 없는 네트워크에도 모바일 노드가 연결될 수 있게 하므로, 홈 에이전트와 모바일 노드에 새로운 소프트웨어만 추가하면 이동성을 구현할 수 있습니다(**단, 포린 네트워크에서 DHCP가 사용 가능해야 함).**

역방향 트래픽(모바일 노드에서 고정 노드로 전송)의 경우는 훨씬 간단합니다. 모바일 노드는 IP 패킷의 **목적지 필드**에 고정 노드의 IP 주소를, **출발지 필드**에 자신의 영구 주소를 입력하여 패킷을 전송합니다. 이후 패킷은 일반적인 IP 라우팅 방식으로 고정 노드로 전달됩니다.

만약 대화 중인 양쪽 노드가 모두 모바일인 경우, 위에서 설명한 절차가 양방향으로 적용됩니다. 즉, 각각의 노드는 상대 노드와 통신하기 위해 홈 에이전트와 포린 에이전트를 통한 [터널링](Virtual%20Network.md##IP%20Tunneling)을 수행해야 합니다.