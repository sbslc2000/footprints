---
상위 링크: "[[IP]]"
---
# Virtual Network
가상 네트워크란 실제의 물리적 연결과는 독립적으로 연결/구축되는 네트워크이다. 실제 사용하는 물리 링크는 공용 링크를 공유하지만, 논리적으로는 분리된 네트워크처럼 동작한다.

사내에 분리된 인트라넷이 필요하지만, 이를 위해 물리적 링크를 구축하기에 너무 큰 비용이 들 때, 전용선 대신 공용 네트워크를 사용하고 그 위에 가상 네트워크를 구축하여 사용할 수 있다. 

위와 같이 논리적으로 구축된 네트워크를 VPN이라고 하며, 이는 Virtual Network의 대표적인 예시이다. VN을 구현하기 위해서 IP Tunneling 기법을 사용할 수 있다.

## IP Tunneling
![](https://i.imgur.com/Ih0wade.png)

Network 1과 Network 2를 사설 네트워크로 만들고자 할 때, 이들간의 물리적 링크를 놓는 방법이 아닌 공용 인터넷 망을 사용하게 만들기 위해서는 IP Tunneling이라는 기법을 사용할 수 있다.

IP Tunneling은 가상의 사설 네트워크 간 데이터를 안전하게 전송하기 위해 캡슐화*encapsulation*을 사용한다. 이 과정에서 사설 네트워크의 IP 패킷을 공용 네트워크의 IP 패킷으로 감싸서 전달하며, 데이터가 인터넷을 통해 전송되는 동안 사설 네트워크의 세부 정보가 노출되지 않기 위해 암호화를 수행하여 전달한다.

### 캡슐화
사설 네트워크의 IP 패킷은 사설 네트워크의 Source Address(Ex. 192.168.1.1)와 Destination Address(192.168.2.1)을 담는다. 이후 이 패킷을 암호화 한 뒤, 새로운 외부 IP 패킷으로 감싼다.

외부 IP 패킷은 출발 네트워크의 공용 IP 주소 (Ex. 203.0.113.1)를 출발지로 하고, 상대방 네트워크의 공용 주소 (198.51.100.1)을 도착지로 한다.

### 전송
캡슐화된 패킷은 공용 인터넷 망을 통해 이동하며, 이 과정에서 거치는 라우터는 외부 패킷을 보고 포워딩을 하므로 사설 정보는 감춰진다. 사설 정보는 그저 외부 IP의 payload로만 존재한다.

### 디캡슐화
목적지 네트워크에 IP 패킷이 도착하면, 외부 IP 패킷은 제거되고, 내부의 사설 IP 패킷을 복호화해야한다. 이후 사설 IP를 담은 패킷은 사설 네트워크로 전달되어 원래의 목적지로 도착한다. 

이 과정을 수행하기 위해 터널링 엔드포인트에 해당하는 IP 라우터는 단순히 패킷을 해석하고 sendDown하는 것이 아닌, 내부를 decrypt하고 새로운 사설 IP 패킷으로 다루는 작업을 수행해야한다.