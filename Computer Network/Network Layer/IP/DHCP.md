---
상위 링크: "[[IP]]"
---
# DHCP 
컴퓨터가 켜지면, 포워딩 테이블과 같은 네트워크 구성 정보가 없는 상태일 것이다. 혹은 다른 네트워크에 연결되었을 때, 기존의 네트워크 구성 정보는 무의미해진다. 또한 켜진 컴퓨터도 하나의 호스트로써 IP 주소를 할당받아야하며, 이는 같은 네트워크에 있는 호스트들과 네트워크 주소를 공유해야하며 다른 컴퓨터들과는 중복되어서는 안된다.

이러한 네트워크 구성정보는 네트워크 상황에 따라 동적으로 결정되어야 하며, 이를 자동으로 구성해주는 프로토콜을 **DHCP**(Dynamic Host Configuration Protocol) 이라고 한다. DHCP를 통해 호스트는 자신의 IP와 서브넷 마스크, 첫번째 홉 라우터의 IP, DNS 서버의 IP를 얻는다.

네트워크에서 자동으로 호스트와 연결해주는 DHCP의 능력 때문에 **플러그 앤 플레이 프로토콜**(plug-and-play protocol) 또는 **제로 구성 프로토콜**(zero-configurtaion protocol)이라고도 불린다.

## 구성 요소
DHCP 프로토콜은 서버-클라이언트 구조로 구성된다. **DHCP 클라이언트**는 네트워크에 대한 정보가 하나도 없으며 이제 막 네트워크에 접속하기를 원하는 호스트이다. **DHCP 서버**는 클라이언트에게 제공할 수 있는 IP 주소 풀과 구성정보들을 유지하는 호스트이다. 주로 집 안에 있는 공유기 혹은 외부 라우터가 이러한 역할을 수행한다.

## 동작 원리
![](https://i.imgur.com/LKAfYoN.png)


최초의 호스트는 자신의 IP를 모르는 상태로, 네트워크 구성정보를 얻기 위해 브로드캐스팅으로 송신하여 정보를 달라고 요청한다. DHCP 서버의 IP 역시 모르는 상태이니 호스트가 할 수 있는 선택지는 브로드캐스팅 밖에 없다. 

이 요청은 DHCP 서버의 수신 포트인 67번 포트를 가지고 있으며, UDP로 송신된다. 이를 **DHCP 발견 메시지(DHCP discover message)**라고 한다.

만약 가정 내 공유기가 DHCP 서버의 역할을 수행할 수 있다면 DHCP 발견 메시지는 DHCP 서버에 직접 전달된다. 한 편, 서브넷 내에 DHCP 구성정보를 제공할 수 있는 호스트가 없는 경우가 있을 수도 있다. 경우에 따라서는 클라이언트의 브로드캐스팅을 받은 공유기가 다른 라우터에 요청을 위임하여 더 멀리있는 DHCP 서버의 구성정보를 가져올 수도 있다. 이를 **DHCP 릴레이**(DHCP Relay)라고 한다.

DHCP 발견 메시지를 받은 DHCP 서버는 **DHCP 제공 메시지(DHCP Offer Message)**로 응답한다. 이 응답 역시 브로드캐스팅되어야 하는데, 이는 여전히 클라이언트가 자신의 주소를 모르기 때문에 유니캐스트가 불가하기 때문이다. 대신 클라이언트가 수신한 제공 메시지가 자신의 것인지 남의 것인지 구분하기 위해서 트랜잭션 ID가 담겨 있다. DHCP 제공 메시지는 트랜잭션 ID와 더불어 클라이언트에게 제공된 IP 주소, 네트워크 마스크, IP 주소 임대 기간 등이 포함되어 있다.

서브넷 내에는 여러 DHCP 서버가 존재할 수 있고, 따라서 클라이언트는 여러 DHCP 제공 메시지를 받을 수 있다. 따라서 클라이언트는 그 중 가장 매력적인 (혹은 가장 먼저 들어온) 제안을 선택하여 DHCP 서버에 이 IP를 사용할 것임을 알려야 한다. 이를 **DHCP 요청 메시지(DHCP Request)**라고 부른다.

이후 DHCP 서버는 DHCP 요청 메시지를 받는다면 **DHCP ACK**을 응답함으로써 구성을 마친다. DHCP ACK을 받은 클라이언트는 DHCP 할당 IP 주소를 임대 기간 동안 사용할 수 있다.

## 이동성과 DHCP
이동성의 측면세어 볼 때, DHCP는 큰 결점이 하나 있다. 노드가 새로운 서브넷에 연결하고자 할 때마다 새로운 IP 주소를 DHCP로부터 얻기 때문에, 이동 노드가 서브넷 사이를 이동할 때 원격 애플리케이션에 대한 TCP 연결은 유지될 수 없다.



