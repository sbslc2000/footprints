---
상위 개념: "[[Inter-AS Routing]]"
RFC: "4271"
---
# BGP
경계 게이트웨이 프로토콜(Border Gateway Protocol, BGP)은 수천 개의 ISP를 연결하는 **분산형 비동기식 자율 시스템 간 라우팅 프로토콜**이다. 

BGP는 AS 간 라우팅의 사실상 표준이다.

## The Role of BGP
모든 라우터는 패킷을 받아 이를 출력 링크로 내보내는 작업을 한다. 만약 패킷의 목적지가 AS 내부에 있다면 AS 내부 라우팅 프로토콜에 의해 전달된다. 패킷의 목적지가 AS 외부에 있는 경우 BGP가 필요하다.

BGP에서는 패킷이 특정한 목적지 주소를 향해서가 아니라 [CIDR](../../IP/IP%20Addressing/CIDR.md) 형식으로 표현된, 주소의 앞쪽 프리픽스를 향해 전달된다.

결국 BGP가 해야하는 역할은 다음과 같이 정의된다.

* 이웃 AS를 통해 도달 가능한 서브넷 프리픽스 정보를 얻는다 : 이를 위해 BGP는 각 서브넷이 자신의 존재를 인터넷 전체에 알릴 수 있도록 한다.
* 패킷이 들어온다면, 서브넷 주소 프리픽스로의 가장 좋은 경로를 결정한다.

## Advertising BGP Route Information

![](https://i.imgur.com/ldanoFs.png)
위 단순한 네트워크에는 3개의 자율 시스템이 있으며, AS3에는 주소 프리픽스가 x인 서브넷을 포함한다.

각 AS에서 각각의 라우터들은 게이트웨이 라우터(gateway router) 혹은 내부 라우터(internal router)이다. 1c, 2a와 같은 게이트웨이 라우터는 AS의 경계에 있는 라우터로서 다른 AS들에 있는 하나 또는 여러개의 라우터와 직접 연결된다. 1a와 같은 내부 라우터는 자신의 AS에 있는 호스트 및 라우터와만 연결된다.

프리픽스 x에 대한 도달 가능성 정보를 위 네트워크의 전체에 알리는 작업을 생각해보자. 먼저 AS3은 AS2에게 BGP 메시지를 보내 x라는 프리픽스를 갖는 서브넷이 AS3에 있음을 알린다. 이 메시지를 'AS3 x'라고 표기하자. 그러면 AS2는 AS1에게 x라는 서브넷이 있고, 이에 도달하려면 먼저 AS2를 통과하고 그 후 AS3으로 갈 수 있다고 알린다. 이 메시지를 'AS2 AS3 x'라고 표기하자. 이런 방식으로 AS는 각각 x의 존재 뿐만 아니라 x에 이르기 위한 자율 시스템의 경로를 알게된다. 

![](https://i.imgur.com/xntRwr6.png)

위는 개념적인 이야기이고, 이는 실제로 어떻게 구현되는가? BGP에서 라우터의 쌍들은 포트번호가 179이고 반영구적인 TCP 연결을 통해 라우팅 정보를 교환한다. 이 TCP 연결을 **BGP 연결**(BGP Connection)이라고 부른다. 나아가 2개의 AS를 연결하는 BGP 연결은 **외부 BGP**(external BGP, eBGP)연결이라고 하며, 같은 AS 내의 라우터 간 BGP 연결은 **내부 BGP**(internal BGP, iBGP)연결 이라고 한다.

도달 가능성 전보를 전파하기 위해서는 iBGP와 eBGP가 모두 사용된다. 게이트웨이 라우터 3a는 게이트웨이 라우터 2c에게 'AS3 x'라는 eBGP 메시지를 보낸다. 그러면 게이트웨이 라우터 2c는 iBGP 메시지 'AS3 x'를 AS2 내부에 브로드캐스팅한다. 이를 전달받은 게이트웨이 라우터 2a는 eBGP 메시지 'AS2 AS3 x'를 1c에게 보낸다. 이후 1c는 iBGP 메시지 'AS2 AS3 x'를 AS1 내부에 브로드캐스팅함으로써 네트워크의 모든 라우터가 x에 대한 정보를 알게 된다.

## BGP Attribute
위에서는 단순히 'AS2 x'와 같은 식으로 경로 정보 메시지를 표현했다. 하지만 BGP는 주소 프리픽스를 알릴 때 몇몇 정보를 추가로 제공한다. 이를 **BGP 속성**(attribute)이라고 한다. BGP의 용어로 프리픽스와 속성을 합쳐 '경로(route)'라고 부른다.

경로에서 중요한 속성 두 가지는 다음과 같다.
* **AS-PATH** : 알림 메시지가 통과하는 AS들의 리스트를 담는다. BGP는 이 속성을 메시지의 루프를 감지하는데에도 사용한다.(AS-PATH에 자신의 AS가 존재한다면, 해당 경로를 폐기)
* **NEXT-HOP** : AS-PATH가 시작되는 라우터의 인터페이스 주소를 담는다. 예를 들어 2a로부터 받은 'AS2 AS3 x' 메시지의 NEXT-HOP은 2a의 주소를 담고 있다.

## Routing Algorithm
만약 특정 서브넷에 대한 주소 경로가 하나라면, 그 경로를 선택하면 그만이다. 하지만 경로가 여러개인 경우 '좋은' 경로를 선택해야한다. 경로 선택 알고리즘은 여러개의 경로로부터 하나의 경로가 나을 때 까지 다음의 제거 규칙을 수행한다.

1. BGP 속성 중 **지역 선호도**(local preference)가 최고 선호값을 가진 경로를 선택한다.
2. 최단 AS-PATH를 가진 경로가 선택된다.
3. 남은 경로들에 대해 [뜨거운 감자 라우팅](Hot%20Potato%20Routing.md)을 수행한다.
4. 여전히 경로들이 남아있담녀 라우터는 BGP 식별자를 사용하여 경로를 선택한다.

